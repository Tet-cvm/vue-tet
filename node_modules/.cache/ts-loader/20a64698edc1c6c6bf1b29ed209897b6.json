{"remainingRequest":"/Users/const/Documents/Movie/Slog/node_modules/babel-loader/lib/index.js!/Users/const/Documents/Movie/Slog/node_modules/ts-loader/index.js??ref--14-2!/Users/const/Documents/Movie/Slog/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/const/Documents/Movie/Slog/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/const/Documents/Movie/Slog/src/components/Manage.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/const/Documents/Movie/Slog/src/components/Manage.vue","mtime":1570777994790},{"path":"/Users/const/Documents/Movie/Slog/node_modules/cache-loader/dist/cjs.js","mtime":1552975946601},{"path":"/Users/const/Documents/Movie/Slog/node_modules/babel-loader/lib/index.js","mtime":1552975946378},{"path":"/Users/const/Documents/Movie/Slog/node_modules/ts-loader/index.js","mtime":1552975955462},{"path":"/Users/const/Documents/Movie/Slog/node_modules/cache-loader/dist/cjs.js","mtime":1552975946601},{"path":"/Users/const/Documents/Movie/Slog/node_modules/vue-loader/lib/index.js","mtime":1552975955943}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es7.promise.finally\";\nexport default {\n  name: 'Manage',\n  data: function data() {\n    return {\n      tableHeight: '',\n      manageData: [],\n      dialogAdd: false,\n      addForm: {\n        img: '',\n        imageUrl: '',\n        role: '',\n        name: '',\n        pwd: ''\n      },\n      addRules: {\n        role: [{\n          required: true,\n          message: '请至少选择一个活动性质',\n          trigger: 'change'\n        }],\n        name: [{\n          required: true,\n          message: '请输入用户名',\n          trigger: 'blur'\n        }, {\n          min: 5,\n          max: 10,\n          message: '长度在 5 到 10 个字符',\n          trigger: 'blur'\n        }],\n        pwd: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 12,\n          message: '长度在 6 到 12 个字符',\n          trigger: 'blur'\n        }]\n      },\n      dialogEdit: false,\n      editForm: {\n        index: Number,\n        unionid: '',\n        img: '',\n        imageUrl: '',\n        role: '',\n        name: '',\n        pwd: '******'\n      },\n      editRules: {\n        role: [{\n          required: true,\n          message: '请至少选择一个活动性质',\n          trigger: 'change'\n        }],\n        name: [{\n          required: true,\n          message: '请输入用户名',\n          trigger: 'blur'\n        }, {\n          min: 5,\n          max: 10,\n          message: '长度在 5 到 10 个字符',\n          trigger: 'blur'\n        }],\n        pwd: [{\n          required: true,\n          message: '请输入密码',\n          trigger: 'blur'\n        }, {\n          min: 6,\n          max: 12,\n          message: '长度在 6 到 12 个字符',\n          trigger: 'blur'\n        }]\n      },\n      dialogDel: false,\n      delForm: {\n        index: Number,\n        unionid: ''\n      }\n    };\n  },\n  created: function created() {\n    var that = this;\n    that.$axios.post('/api/manage/list', {}, {}).then(function (res) {\n      that.manageData = res.data;\n    }).catch(function (err) {\n      that.$toast(that, 'error', '网络错误～');\n    });\n  },\n  mounted: function mounted() {\n    var that = this;\n    that.tableHeight = that.$refs.manage.offsetHeight;\n  },\n  methods: {\n    onFilter: function onFilter(role) {\n      switch (role) {\n        case 0:\n          return '超级管理员';\n\n        case 1:\n          return '管理员';\n\n        case 2:\n          return '文案编辑';\n      }\n    },\n    handleAdd: function handleAdd(index, row) {\n      this.dialogAdd = true;\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      var that = this;\n      var isJPG = file.type === 'image/jpeg' || file.type === 'image/png';\n      var isLt1M = file.size / 1024 / 1024 < 1;\n\n      if (!isJPG) {\n        that.$toast(that, 'error', '上传头像图片只能是 JPG PNG 格式!');\n        return;\n      }\n\n      if (!isLt1M) {\n        that.$toast(that, 'error', '上传头像图片大小不能超过 1MB!');\n        return;\n      }\n\n      return isJPG && isLt1M;\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res, file) {\n      if (this.dialogAdd) {\n        this.addForm.img = res;\n        this.addForm.imageUrl = URL.createObjectURL(file.raw);\n      } else if (this.dialogEdit) {\n        this.editForm.img = res;\n        this.editForm.imageUrl = URL.createObjectURL(file.raw);\n      }\n    },\n    onAddSubmit: function onAddSubmit(addForm) {\n      var that = this;\n      that.$refs[addForm].validate(function (valid) {\n        if (valid) {\n          that.$axios.post('/api/manage/add', that.$qs.stringify(that.addForm), {}).then(function (res) {\n            if (res.data.status) {\n              that.dialogAdd = false;\n              that.manageData.push(res.data.data[0]);\n              that.$toast(that, 'success', res.data.message);\n            } else {\n              that.$toast(that, 'error', res.data.message);\n            }\n          }).catch(function (err) {\n            that.$toast(that, 'error', '网络错误～');\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    handleEdit: function handleEdit(index, row) {\n      this.editForm.index = index;\n      this.editForm.unionid = this.manageData[index].unionid;\n      this.editForm.img = this.manageData[index].img;\n      this.editForm.imageUrl = this.manageData[index].icon;\n      this.editForm.role = this.manageData[index].role.toString();\n      this.editForm.name = this.manageData[index].name;\n      this.dialogEdit = true;\n    },\n    onEditSubmit: function onEditSubmit(editForm) {\n      var that = this;\n      that.$refs[editForm].validate(function (valid) {\n        if (valid) {\n          that.$axios.post('/api/manage/edit', that.$qs.stringify(that.editForm), {}).then(function (res) {\n            if (res.data.status) {\n              that.manageData[that.editForm.index].role = res.data.data[0].role;\n              that.manageData[that.editForm.index].name = res.data.data[0].name;\n              that.manageData[that.editForm.index].time = res.data.data[0].time;\n              that.manageData[that.editForm.index].img = res.data.data[0].img;\n              that.manageData[that.editForm.index].icon = res.data.data[0].icon;\n              that.dialogEdit = false;\n              that.$toast(that, 'success', res.data.message);\n            } else {\n              that.$toast(that, 'error', res.data.message);\n            }\n          }).catch(function (err) {\n            that.$toast(that, 'error', '网络错误～');\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    handleDelete: function handleDelete(index, row) {\n      this.delForm.index = index;\n      this.delForm.unionid = row.unionid;\n      this.dialogDel = true;\n    },\n    onDelSubmit: function onDelSubmit() {\n      var that = this;\n      var data = {\n        'unionid': that.delForm.unionid\n      };\n      that.$axios.post('/api/manage/del', that.$qs.stringify(data), {}).then(function (res) {\n        if (res.data.status) {\n          that.manageData.splice(that.delForm.index, 1);\n          that.dialogDel = false;\n          that.$toast(that, 'success', res.data.message);\n        } else {\n          that.$toast(that, 'error', res.data.message);\n        }\n      }).catch(function (err) {\n        that.$toast(that, 'error', '网络错误～');\n      });\n    }\n  }\n};",{"version":3,"sources":["/Users/const/Documents/Movie/Slog/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/const/Documents/Movie/Slog/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/const/Documents/Movie/Slog/src/components/Manage.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nexport default {\n    name: 'Manage',\n    data() {\n        return {\n            tableHeight: '',\n            manageData: [],\n            dialogAdd: false,\n            addForm: {\n                img: '',\n                imageUrl: '',\n                role: '',\n                name: '',\n                pwd: ''\n            },\n            addRules: {\n                role: [\n                    { required: true, message: '请至少选择一个活动性质', trigger: 'change' }\n                ],\n                name: [\n                    { required: true, message: '请输入用户名', trigger: 'blur' },\n                    { min: 5, max: 10, message: '长度在 5 到 10 个字符', trigger: 'blur' }\n                ],\n                pwd: [\n                    { required: true, message: '请输入密码', trigger: 'blur' },\n                    { min: 6, max: 12, message: '长度在 6 到 12 个字符', trigger: 'blur' }\n                ]\n            },\n            dialogEdit: false,\n            editForm: {\n                index: Number,\n                unionid: '',\n                img: '',\n                imageUrl: '',\n                role: '',\n                name: '',\n                pwd: '******'\n            },\n            editRules: {\n                role: [\n                    { required: true, message: '请至少选择一个活动性质', trigger: 'change' }\n                ],\n                name: [\n                    { required: true, message: '请输入用户名', trigger: 'blur' },\n                    { min: 5, max: 10, message: '长度在 5 到 10 个字符', trigger: 'blur' }\n                ],\n                pwd: [\n                    { required: true, message: '请输入密码', trigger: 'blur' },\n                    { min: 6, max: 12, message: '长度在 6 到 12 个字符', trigger: 'blur' }\n                ]\n            },\n            dialogDel: false,\n            delForm: {\n                index: Number,\n                unionid: ''\n            }\n        }\n    },\n    created() {\n        let that = this;\n        that.$axios.post('/api/manage/list', {}, {})\n        .then(function(res){\n            that.manageData = res.data;\n        })\n        .catch(function(err) {\n            that.$toast(that, 'error', '网络错误～');\n        })\n    },\n    mounted() {\n        let that = this;\n        that.tableHeight = that.$refs.manage.offsetHeight;\n    },\n    methods: {\n        onFilter: function(role) {\n            switch(role)\n            {\n                case 0:\n                    return '超级管理员';\n                case 1:\n                    return '管理员';\n                case 2:\n                    return '文案编辑';\n            }\n        },\n        handleAdd(index, row) {\n            this.dialogAdd = true;\n        },\n        beforeAvatarUpload(file) {\n            let that = this;\n            const isJPG = file.type === 'image/jpeg' || file.type === 'image/png';\n            const isLt1M = file.size / 1024 / 1024 < 1;\n\n            if (!isJPG) {\n                that.$toast(that, 'error', '上传头像图片只能是 JPG PNG 格式!');\n                return;\n            }\n            if (!isLt1M) {\n                that.$toast(that, 'error', '上传头像图片大小不能超过 1MB!');\n                return;\n            }\n            return isJPG && isLt1M;\n        },\n        handleAvatarSuccess(res, file) {\n            if (this.dialogAdd) {\n                this.addForm.img = res;\n                this.addForm.imageUrl = URL.createObjectURL(file.raw);\n            } else if (this.dialogEdit) {\n                this.editForm.img = res;\n                this.editForm.imageUrl = URL.createObjectURL(file.raw);\n            }\n        },\n        onAddSubmit(addForm) {\n            let that = this;\n            that.$refs[addForm].validate((valid)=>{\n                if (valid) {\n                    that.$axios.post('/api/manage/add', that.$qs.stringify(that.addForm), {})\n                    .then(function(res){\n                        if (res.data.status) {\n                            that.dialogAdd = false;\n                            that.manageData.push(res.data.data[0]);\n                            that.$toast(that, 'success', res.data.message);\n                        } else {\n                            that.$toast(that, 'error', res.data.message);\n                        }\n                    })\n                    .catch(function(err) {\n                        that.$toast(that, 'error', '网络错误～');\n                    })\n                } else {\n                    return false;\n                }\n            })\n        },\n        handleEdit(index, row) {\n            this.editForm.index = index;\n            this.editForm.unionid = this.manageData[index].unionid;\n            this.editForm.img = this.manageData[index].img;\n            this.editForm.imageUrl = this.manageData[index].icon;\n            this.editForm.role = this.manageData[index].role.toString();\n            this.editForm.name = this.manageData[index].name;\n            this.dialogEdit = true;\n        },\n        onEditSubmit(editForm) {\n            let that = this;\n            that.$refs[editForm].validate((valid)=>{\n                if (valid) {\n                    that.$axios.post('/api/manage/edit', that.$qs.stringify(that.editForm), {})\n                    .then(function(res){\n                        if (res.data.status) {\n                            that.manageData[that.editForm.index].role = res.data.data[0].role;\n                            that.manageData[that.editForm.index].name = res.data.data[0].name;\n                            that.manageData[that.editForm.index].time = res.data.data[0].time;\n                            that.manageData[that.editForm.index].img = res.data.data[0].img;\n                            that.manageData[that.editForm.index].icon = res.data.data[0].icon;\n                            that.dialogEdit = false;\n                            that.$toast(that, 'success', res.data.message);\n                        } else {\n                            that.$toast(that, 'error', res.data.message);\n                        }\n                    })\n                    .catch(function(err) {\n                        that.$toast(that, 'error', '网络错误～');\n                    })\n                } else {\n                    return false;\n                }\n            })\n        },\n        handleDelete(index, row) {\n            this.delForm.index = index;\n            this.delForm.unionid = row.unionid;\n            this.dialogDel = true;\n        },\n        onDelSubmit() {\n            let that = this;\n            let data = {\n                'unionid': that.delForm.unionid\n            }\n            that.$axios.post('/api/manage/del', that.$qs.stringify(data), {})\n            .then(function(res){\n                if (res.data.status) {\n                    that.manageData.splice(that.delForm.index, 1);\n                    that.dialogDel = false;\n                    that.$toast(that, 'success', res.data.message);\n                } else {\n                    that.$toast(that, 'error', res.data.message);\n                }\n            })\n            .catch(function(err) {\n                that.$toast(that, 'error', '网络错误～');\n            })\n        }\n    }\n}\n"],"sourceRoot":""}]}