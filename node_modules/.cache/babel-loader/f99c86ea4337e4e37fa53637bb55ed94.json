{"remainingRequest":"/Users/const/Documents/Vue/vue-tet/node_modules/babel-loader/lib/index.js!/Users/const/Documents/Vue/vue-tet/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/const/Documents/Vue/vue-tet/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/const/Documents/Vue/vue-tet/src/components/Version.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/const/Documents/Vue/vue-tet/src/components/Version.vue","mtime":1556532130228},{"path":"/Users/const/Documents/Vue/vue-tet/node_modules/cache-loader/dist/cjs.js","mtime":1552975946601},{"path":"/Users/const/Documents/Vue/vue-tet/node_modules/babel-loader/lib/index.js","mtime":1552975946378},{"path":"/Users/const/Documents/Vue/vue-tet/node_modules/cache-loader/dist/cjs.js","mtime":1552975946601},{"path":"/Users/const/Documents/Vue/vue-tet/node_modules/vue-loader/lib/index.js","mtime":1552975955943}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Vue from 'vue';\nimport axios from 'axios';\nimport Qs from 'qs';\nimport { onTips } from '@/assets/js/common.js';\nexport default {\n  name: 'Version',\n  data: function data() {\n    return {\n      aaa: true,\n      complete: false,\n      //是否加载完成\n      resData: Array,\n      saveData: [],\n      VersionData: {\n        pro: Number,\n        project: [],\n        rel: Number,\n        release: [{\n          value: 1,\n          label: '开发环境'\n        }, {\n          value: 0,\n          label: '生产环境'\n        }],\n        url: '',\n        branch: '',\n        type: Number\n      },\n      disabled: true,\n      ip: '',\n      VersionRules: {\n        pro: [{\n          required: true,\n          message: '',\n          trigger: 'blur'\n        }],\n        rel: [{\n          required: true,\n          message: '',\n          trigger: 'blur'\n        }],\n        url: [{\n          required: true,\n          message: '请输入 git | svn 地址',\n          trigger: 'blur'\n        }, {\n          min: 0,\n          max: 100,\n          message: '请输入合法的 git | svn 地址',\n          trigger: 'blur'\n        }],\n        branch: [{\n          required: true,\n          message: '请输入默认 (开发 | 生产环境) 分支',\n          trigger: 'blur'\n        }, {\n          min: 0,\n          max: 24,\n          message: '请输入合法的分支名称',\n          trigger: 'blur'\n        }],\n        type: [{\n          required: true,\n          message: '',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created: function created() {\n    var that = this;\n    axios.post('/api/website', {}, {}).then(function (res) {\n      if (res.data.status) {\n        var resData = res.data.data;\n        that.resData = resData;\n        var pro = Number;\n        var project = [];\n\n        for (var i = 0; i < resData.length; i++) {\n          if (resData[i].active) {\n            pro = resData[i].id;\n            that.VersionData.rel = resData[i].release;\n            that.VersionData.url = resData[i].url;\n            that.VersionData.branch = resData[i].branch;\n            that.VersionData.type = resData[i].type.toString();\n            that.ip = resData[i].ip;\n          }\n\n          var data = {\n            value: resData[i].id,\n            label: resData[i].domain,\n            status: resData[i].status,\n            type: resData[i].type == 2 ? 'svn' : 'git'\n          };\n          project.unshift(data);\n        }\n\n        that.VersionData.project = project;\n        that.VersionData.pro = pro;\n        that.saveData = [that.VersionData.pro, that.VersionData.rel, that.VersionData.url, that.VersionData.branch];\n        that.complete = true;\n      } else {\n        onTips(that, 'error', res.data.info);\n      }\n    }).catch(function (err) {\n      onTips(that, 'error', '网络错误~');\n    });\n  },\n  watch: {\n    VersionData: {\n      handler: function handler() {\n        var that = this;\n\n        for (var i = 0; i < that.resData.length; i++) {\n          if (that.resData[i].id == that.VersionData.pro) {\n            if (that.resData[i].status) {\n              var arr = [that.VersionData.pro, that.VersionData.rel, that.VersionData.url, that.VersionData.branch];\n\n              if (arr.toString() == that.saveData.toString()) {\n                that.disabled = true;\n              } else {\n                that.disabled = false;\n              }\n            } else {\n              that.disabled = false;\n            }\n          }\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    onSelect: function onSelect() {\n      var that = this;\n\n      for (var i = 0; i < that.resData.length; i++) {\n        if (that.resData[i].id == that.VersionData.pro) {\n          that.VersionData.rel = that.resData[i].release;\n          that.VersionData.url = that.resData[i].url;\n          that.VersionData.branch = that.resData[i].branch;\n          that.VersionData.type = that.resData[i].type.toString();\n          that.saveData = [that.resData[i].id, that.resData[i].release, that.resData[i].url, that.resData[i].branch];\n        }\n      }\n    },\n    onSubmit: function onSubmit(VersionData) {\n      var that = this;\n      that.$refs.VersionData.validate(function (valid) {\n        if (valid) {\n          //判断url是否与type匹配\n          var pass = false;\n\n          if (that.VersionData.type == '0') {\n            pass = that.VersionData.url.indexOf('git@') != -1;\n          } else if (that.VersionData.type == '1') {\n            pass = that.VersionData.url.indexOf('https://github.com') != -1;\n          } else if (that.VersionData.type == '2') {\n            pass = that.VersionData.url.indexOf('--username') != -1;\n          }\n\n          if (pass) {\n            that.onAxios();\n          } else {\n            onTips(that, 'error', 'git | svn地址与版本控制系统不匹配~');\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n    onAxios: function onAxios() {\n      var that = this;\n      var data = {\n        'id': that.VersionData.pro,\n        'project': that.VersionData.pro,\n        'release': that.VersionData.rel,\n        'uri': that.VersionData.url,\n        'branch': that.VersionData.branch,\n        'type': that.VersionData.type\n      };\n      axios.post('/api/mate', Qs.stringify(data), {}).then(function (res) {\n        if (res.data.status) {\n          onTips(that, 'success', res.data.info);\n        } else {\n          onTips(that, 'error', res.data.info);\n        }\n      }).catch(function () {\n        onTips(that, 'error', '网络错误~');\n      });\n    }\n  }\n};",{"version":3,"sources":["Version.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"version\">\n        <template v-if=\"complete\">\n            <el-form label-position=\"top\" :model=\"VersionData\" :rules=\"VersionRules\" ref=\"VersionData\">\n                <div class=\"project\">\n                    <span class=\"config\">项目配置 ( git | svn )</span>\n                    <el-divider></el-divider>\n                    <div class=\"content\">\n                        <el-row :gutter=\"20\">\n                            <el-col :span=\"12\">\n                                <el-form-item label=\"项目名称\" prop=\"pro\">\n                                    <el-select v-model=\"VersionData.pro\" @change=\"onSelect()\" size=\"medium\">\n                                        <el-option\n                                            v-for=\"item in VersionData.project\"\n                                            :key=\"item.value\"\n                                            :label=\"item.label\"\n                                            :value=\"item.value\">\n                                            <span style=\"float: left\">{{ item.label }}</span>\n                                            <span style=\"float: right; color: #8492a6; font-size: 13px\">{{ item.status ? '已完成配置('+ item.type +')' : '未配置' }}</span>\n                                        </el-option>\n                                    </el-select>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"12\">\n                                <el-form-item label=\"部署环境\" prop=\"rel\">\n                                    <el-select v-model=\"VersionData.rel\" size=\"medium\">\n                                        <el-option\n                                            v-for=\"item in VersionData.release\"\n                                            :key=\"item.value\"\n                                            :label=\"item.label\"\n                                            :value=\"item.value\">\n                                        </el-option>\n                                    </el-select>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"12\">\n                                <el-form-item label=\"git | svn地址\" prop=\"url\">\n                                    <el-input v-model=\"VersionData.url\" size=\"medium\" placeholder=\"https://github.com/Tet-cvm/test.git\"></el-input>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"12\">\n                                <el-form-item label=\"默认分支\" prop=\"branch\">\n                                    <el-input v-model=\"VersionData.branch\" size=\"medium\"></el-input>\n                                </el-form-item>\n                            </el-col>\n                            <el-col :span=\"24\">\n                                <el-form-item label=\"选择版本控制系统\" prop=\"type\">\n                                    <el-tooltip placement=\"top\" popper-class=\"popper\">\n                                        <div slot=\"content\">请先设置SSH keys<br>然后再设置站点环境</div>\n                                        <el-radio v-model=\"VersionData.type\" label=\"0\" border>Git (ssh)</el-radio>\n                                    </el-tooltip>\n                                    <el-tooltip placement=\"top\" popper-class=\"popper\">\n                                        <div slot=\"content\">设置站点环境, 终端执行以下命令<br>$ sh /git.sh<br>$ Username: you username<br>$ password: you password</div>\n                                        <el-radio v-model=\"VersionData.type\" label=\"1\" border>Git (password)</el-radio>\n                                    </el-tooltip>\n                                    <el-tooltip placement=\"top\" popper-class=\"popper\">\n                                        <div slot=\"content\">设置站点环境, 终端执行以下命令<br>$ password: you password<br>$ yes</div>\n                                        <el-radio v-model=\"VersionData.type\" label=\"2\" border>Svn (password)</el-radio>\n                                    </el-tooltip>\n                                </el-form-item>\n                            </el-col>\n                        </el-row>\n                    </div>\n                </div>\n                <div class=\"server\">\n                    <span class=\"target\">目标服务器: {{ ip }}</span>\n                    <el-divider></el-divider>\n                </div>\n                <div class=\"submit\">\n                    <el-form-item>\n                        <el-button type=\"primary\" size=\"medium\" :disabled=\"disabled\" @click=\"onSubmit(VersionData)\">设置环境</el-button>\n                    </el-form-item>\n                </div>\n            </el-form>\n        </template>\n    </div>\n</template>\n\n<script>\nimport Vue from 'vue'\nimport axios from 'axios';\nimport Qs from 'qs';\nimport { onTips } from '@/assets/js/common.js';\nexport default {\n    name: 'Version',\n    data() {\n        return {\n            aaa: true,\n            complete: false, //是否加载完成\n            resData: Array,\n            saveData: [],\n            VersionData: {\n                pro: Number,\n                project: [],\n                rel: Number,\n                release: [\n                    { value: 1, label: '开发环境' },\n                    { value: 0, label: '生产环境' },\n                ],\n                url: '',\n                branch: '',\n                type: Number,\n            },\n            disabled: true,\n            ip: '',\n            VersionRules: {\n                pro: [\n                    { required: true, message: '', trigger: 'blur' },\n                    // { min: 2, max: 10, message: '', trigger: 'blur' }\n                ],\n                rel: [\n                    { required: true, message: '', trigger: 'blur' },\n                    // { min: 2, max: 10, message: '', trigger: 'blur' }\n                ],\n                url: [\n                    { required: true, message: '请输入 git | svn 地址', trigger: 'blur' },\n                    { min: 0, max: 100, message: '请输入合法的 git | svn 地址', trigger: 'blur' }\n                ],\n                branch: [\n                    { required: true, message: '请输入默认 (开发 | 生产环境) 分支', trigger: 'blur' },\n                    { min: 0, max: 24, message: '请输入合法的分支名称', trigger: 'blur' }\n                ],\n                type: [\n                    { required: true, message: '', trigger: 'blur' },\n                ]\n            }\n        }\n    },\n    created() {\n        let that = this;\n        axios.post('/api/website', {}, {})\n        .then(function(res) {\n            if (res.data.status) {\n                let resData = res.data.data;\n                that.resData = resData;\n                let pro = Number;\n                let project = [];\n\n                for (let i = 0; i < resData.length; i++) {\n                    if (resData[i].active) {\n                        pro = resData[i].id;\n                        that.VersionData.rel = resData[i].release;\n                        that.VersionData.url = resData[i].url;\n                        that.VersionData.branch = resData[i].branch;\n                        that.VersionData.type = resData[i].type.toString();\n                        that.ip = resData[i].ip;\n                    }\n                    let data = {value: resData[i].id, label: resData[i].domain, status: resData[i].status, type: resData[i].type==2 ? 'svn': 'git' }\n                    project.unshift(data);\n                }\n                that.VersionData.project = project;\n                that.VersionData.pro = pro;\n                that.saveData = [that.VersionData.pro, that.VersionData.rel, that.VersionData.url, that.VersionData.branch]\n                that.complete = true;\n            } else {\n                onTips(that, 'error', res.data.info);\n            }\n        })\n        .catch(function(err) {\n            onTips(that, 'error', '网络错误~');\n        })\n    },\n    watch: {\n        VersionData: {\n            handler: function() {\n                let that = this;\n                for (let i=0; i<that.resData.length; i++) {\n                    if (that.resData[i].id == that.VersionData.pro) {\n                        if (that.resData[i].status) {\n                            let arr = [that.VersionData.pro, that.VersionData.rel, that.VersionData.url, that.VersionData.branch];\n                            if (arr.toString() == that.saveData.toString()) {\n                                that.disabled = true;\n                            } else {\n                                that.disabled = false;\n                            }\n                        } else {\n                            that.disabled = false;\n                        }\n                    }\n                }\n            },\n            deep: true\n        }\n    },\n    methods: {\n        onSelect: function() {\n            let that = this;\n            for (let i=0; i<that.resData.length; i++) {\n                if (that.resData[i].id == that.VersionData.pro) {\n                    that.VersionData.rel = that.resData[i].release;\n                    that.VersionData.url = that.resData[i].url;\n                    that.VersionData.branch = that.resData[i].branch;\n                    that.VersionData.type = that.resData[i].type.toString();\n                    that.saveData = [that.resData[i].id, that.resData[i].release, that.resData[i].url, that.resData[i].branch];\n                }\n            }\n        },\n        onSubmit: function(VersionData) {\n            let that = this;\n            that.$refs.VersionData.validate((valid)=>{\n                if (valid) {\n                    //判断url是否与type匹配\n                    let pass = false;\n                    if (that.VersionData.type == '0') {\n                        pass = that.VersionData.url.indexOf('git@') != -1\n                    } else if (that.VersionData.type == '1') {\n                        pass = that.VersionData.url.indexOf('https://github.com') != -1\n                    } else if (that.VersionData.type == '2') {\n                        pass = that.VersionData.url.indexOf('--username') != -1\n                    }\n\n                    if (pass) {\n                        that.onAxios();\n                    } else {\n                        onTips(that, 'error', 'git | svn地址与版本控制系统不匹配~');\n                    }\n                } else {\n                    return false\n                }\n            })\n        },\n        onAxios: function() {\n            let that = this;\n            let data = {\n                'id': that.VersionData.pro,\n                'project': that.VersionData.pro,\n                'release': that.VersionData.rel,\n                'uri': that.VersionData.url,\n                'branch': that.VersionData.branch,\n                'type': that.VersionData.type\n            };\n\n            axios.post('/api/mate', Qs.stringify(data), {})\n            .then(function(res) {\n                if (res.data.status) {\n                    onTips(that, 'success', res.data.info);\n                } else {\n                    onTips(that, 'error', res.data.info);\n                }\n            })\n            .catch(function() {\n                onTips(that, 'error', '网络错误~');\n            })\n        }\n    }\n}\n</script>\n\n<style scoped lang=\"less\">\n.content {\n    padding: 0 32px;\n}\n.content .el-input {\n    width: 82%;\n}\n.config {\n    display: block;\n    margin: 28px 0 0 32px;\n}\n.target, .submit {\n    display: block;\n    margin: 58px 0 0 32px;\n}\n.popper div {\n    font-size: 13px;\n    font-weight: normal;\n}\n</style>\n\n\n"],"sourceRoot":"src/components"}]}